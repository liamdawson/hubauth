CWD := $(shell pwd)
TARDIR := hubauth-@VERSION@
RPMBUILD := $(HOME)/rpmbuild

devbuild:
	cargo build

build:
	cargo build --release

dist:
	@rm -fr ./dist
	mkdir -p ./dist/$(TARDIR)
	rsync -r --exclude .git/ --exclude dist/ --exclude target/ $(CWD)/ ./dist/$(TARDIR)
	cd ./dist/; tar -zcf $(TARDIR).tar.gz $(TARDIR);

install: build
	install -d $(DESTDIR)@BINDIR@
	install -m 755 ./target/release/hubauth ${DESTDIR}@BINDIR@/hubauth

rpm: dist
	rm -rf $(RPMBUILD)/SOURCES/hubauth*
	rm -rf $(RPMBUILD)/BUILD/hubauth*
	mkdir -p $(RPMBUILD)/SOURCES
	cp ./dist/hubauth-@VERSION@.tar.gz $(RPMBUILD)/SOURCES; \
	rpmbuild -ba hubauth.spec
